services:
  # Proton - Open Source Streaming Database
  # For enterprise Timeplus, replace with: timeplus/timeplusd:latest
  workspace-init:
    image: busybox
    command: ["sh", "-c", "chmod 777 /app/workspaces"]
    volumes:
      - workspace_data:/app/workspaces
    restart: "no"
  proton:
    image: timeplus/pulsebot-proton:0.2.0
    platform: linux/amd64  # Required for ARM Macs (runs via Rosetta)
    ports:
      - "8123:8123"   # HTTP port (batch queries)
      - "3218:3218"   # Streaming port
      - "8463:8463"   # Native TCP
      - "8001:8001"   # Agent API and Web UI
    environment:
      - PULSEBOT_PROVIDER=ollama
      - PULSEBOT_MODEL=kimi-k2.5:cloud
      - OLLAMA_HOST=http://host.docker.internal:11434
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
    volumes:
      - proton_data:/var/lib/proton
      - workspace_data:/app/workspaces:rw
    depends_on:
      workspace-init:
        condition: service_completed_successfully
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8123/"]
      interval: 10s
      timeout: 5s
      retries: 5

volumes:
  proton_data:
  workspace_data:
