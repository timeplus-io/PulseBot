services:
  workspace-init:
    image: busybox
    command: ["sh", "-c", "chmod 777 /app/workspaces"]
    volumes:
      - workspace_data:/app/workspaces
    restart: "no"
  # Proton - Open Source Streaming Database
  # For enterprise Timeplus, replace with: timeplus/timeplusd:latest
  timeplus:
    image: timeplus/pulsebot-timeplus:0.2.0
    platform: linux/amd64
    ports:
      - 8000:8000
      - 8001:8001
      - 8463:8463
      - 8123:8123
      - 3218:3218
      - 3001:3001
    environment:
      - ENABLE_DATA_PREALLOCATE=false
      - PULSEBOT_PROVIDER=ollama
      - PULSEBOT_MODEL=kimi-k2.5:cloud
      - OLLAMA_HOST=http://host.docker.internal:11434
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
    volumes:
      - timeplus_data:/timeplus/data/
      - workspace_data:/app/workspaces:rw
    depends_on:
      workspace-init:
        condition: service_completed_successfully
    healthcheck:
      test: ["CMD-SHELL", "timeplusd client --user proton --password timeplus@t+ --query 'select 1'"]
      interval: 10s
      timeout: 5s
      retries: 5

volumes:
  timeplus_data:
  workspace_data:
